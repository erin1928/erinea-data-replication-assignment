---
title: "Data Replication"
author: "Erin Anderson"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

My study is testing the theory that bees prefer to frequent the same flowers, as opposed to visiting multiple different flowers in a patch. Sampling was done in Sweden with reared colonies of bees in an open fied. Bees were individually marked and ID'd and left to pollinate for 5 days at a time. After each period pollen was removed from the bees bodies and collected in jars. Mahcine learning was used to identify pollen samples from specific flowers which were identified in the field. After the program was run, individual pollen samples from ID'd bees were added to a csv file, noting each bee and where their pollen came from, and how much (in g) pollen they had extracted from the flower per trip. 

I will be looking for you to clearly take your reader through all of the elements of data manipulation, analysis, and, where appropriate, visualization. You should provide as much coding detail, explanation, and output tables as necessary to compare your results to those published.

Annotate your code well, and good luck!


!["Bee flower constancy"](/Users/erin/desktop/bee_flower_consistency.pdf)


## chi squared test, p value, stray from normal
```{r csv, include=FALSE}
bee_data <- read.csv("bee_data.csv", sep = ',', header = TRUE, stringsAsFactors = TRUE)
bee_data
head(bee_data)
```
First we must identify and name all of the relevant columns within the csv. Here I am calling the columns of flower species that pollen was taken from, and giving them an easier and more memorable name to work with throughout the replication assignment.
```{r calling rows, include=FALSE}
Prunus <- (bee_data$P_Prunus.group)
Prunus
Brassicaceae <- (bee_data$P_Brassicaceae)
Brassicaceae
Lamium <- (bee_data$P_Lamium)
Lamium
Acer <- (bee_data$P_Acer)
Acer
Lonicera <- (bee_data$P_Lonicera)
Lonicera
Salix <- (bee_data$P_Salix)
Salix
Prunus_Group_B <- sample(bee_data$P_Prunus.groupB)
Prunus_Group_B
Papaver <- (bee_data$P_Papaver)
Papaver
Cytisus <- (bee_data$P_Cytisus)
Cytisus
Trifolium_repens <- (bee_data$P_Trifolium.repens.group)
Trifolium_repens
Aesculus <- (bee_data$P_Aesculus)
Aesculus
Pulmonaria_Group <- (bee_data$P_Pulmonaria.group)
Pulmonaria_Group
Laburnum <- (bee_data$P_Laburnum)
Laburnum
Phacelia <- (bee_data$P_Phacelia)
Phacelia
```

Now, in order to replicate our first figure, the mean weight (in grams) of each pollen type needs to be calculated. By using the mean() function I am directly calculating the averages of each column that I assigned in the previous step.
```{r calculating means, include=TRUE}
mean(Prunus)
mean(Brassicaceae)
mean(Lamium)
mean(Acer)
mean(Lonicera)
mean(Salix)
mean(Prunus_Group_B)
mean(Papaver)
mean(Cytisus)
mean(Trifolium_repens)
mean(Aesculus)
mean(Pulmonaria_Group)
mean(Laburnum)
mean(Phacelia)
```
Now we are going to start plotting our figure. First I am setting a character vecotr "means" that is comprised of all of the means calculated in the first step. This will allow me to call my "means" easily and quickly when I code my bar chart. Next I'm setting a character vector of flower species "Flower_species" for the same reason. This will allow me to call all of the species on the x-axis using the names.arg() argument later on. Finally I am importing a package to allow me to assign colors to my bars to distinguish species visually.
```{r bar chart, include=TRUE}
#setting a common numerical value to pull from in the y axis
means <- c(mean(Prunus), mean(Brassicaceae), mean(Lamium), mean(Acer), mean(Lonicera), mean(Salix), mean(Prunus_Group_B), mean(Papaver), mean(Cytisus), mean(Trifolium_repens), mean(Aesculus), mean(Pulmonaria_Group), mean(Laburnum), mean(Phacelia))
#Now using a character vector to pull names of each group on the x-axis
Flower_species <- c("Prunus", "Brassicaceae", "Lamium", "Acer", "Lonicera", "Salix", "Prunus_Group_B", "Papaver", "Cytisus", "Trifolium_repens", "Aesculus", "Pulmonaria_Group", "Laburnum", "Phacelia")
library(RColorBrewer)
coul <- brewer.pal(14, "Set3")
#This sets rainbow colors for my graph
par(mar=c(8,4,4,1)+.1)
#This changes the margins on my graph, the first one deals with the bottom allowing me to fit all the words onto the chart
barplot(means, ylim = c(0.00, 0.20), names.arg = Flower_species, las = 2, space = 0.05, xlab = " ", ylab = "Pollen Proportion", main = "Pollen Proportion vs. Flower Species", col=coul, cex.axis=0.9)
# las = 2 moves the x-axis labels vertical
```

![Original Chart](Original Chart.png)

In the paper, the researchers ran a Jaccard similarity test on a scale of 0 to 1. Jaccard similarity of 0 means the variables had no overlap, and 1 means the variables had extreme overlap. I ran one of the similarity tests between Pollen sample and colony ID and got that there was no overlap between the colony the bees were a part of and the pollen they sampled.
```{r Jaccard pollen similarity, include=TRUE}
jaccard <- function(a, b) {
    intersection = length(intersect(a, b))
    union = length(a) + length(b) - intersection
    return (intersection/union)
}
colony <- (bee_data$coln)
pollen.sample <- (bee_data$filn)
jaccard(a,b)
```

```{r LMM, include=TRUE}
colony <- (bee_data$coln) #colony the sample came from
pollen.sample <- (bee_data$filn) #each pollen sample
library(lme4)
lmer(data = bee_data, pollen.sample ~ colony + (1 | colony))
summary(lme)
```

```{r LMM, include=TRUE}
bees <- (bee_data$bbid)
lmer(pollen.sample ~ colony + (colony | bees), bee_data)
```
The author's stated that the pollen from the Prunus group of flowers was the most pollinated overall, with the total percentage of pollen samples from these flowers equaling 20%. To test this I first named all the means of each flower species to be able to use them in a later calculation. Then, I added all of these called means together to get the whole number of pollen samples from each species together. Then, I divided that total means number just calculated by the mean of the prunus group flowers and multiplied by 100%. My final output was 22.07%, rounding down to 20%, the same as what our author's stated.
```{r percentage Brassicaceae, include=TRUE}
mean_Prunus <- mean(Prunus)
mean_Brassicaceae <- mean(Brassicaceae)
mean_Lamium <- mean(Lamium)
mean_Acer <- mean(Acer)
mean_Lonicera <- mean(Lonicera)
mean_Salix <- mean(Salix)
mean_Prunus_Group_B <- mean(Prunus_Group_B)
mean_Papaver <- mean(Papaver)
mean_Cytisus <- mean(Cytisus)
mean_Trifolium_repens <- mean(Trifolium_repens)
mean_Aesculus <- mean(Aesculus)
mean_Pulmonaria_Group <- mean(Pulmonaria_Group)
mean_Laburnum <- mean(Laburnum)
mean_Phacelia <- mean(Phacelia)

total_means <- (mean_Prunus + mean_Brassicaceae + mean_Lamium + mean_Acer + mean_Lonicera + mean_Salix + mean_Prunus_Group_B + mean_Papaver + mean_Cytisus + mean_Trifolium_repens + mean_Aesculus + mean_Pulmonaria_Group + mean_Laburnum + mean_Phacelia)
total_means
percent_prunus_group <- (mean_Prunus/total_means)*100
percent_prunus_group
```
